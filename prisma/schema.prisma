generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model Users {
  id         Int            @id @default(autoincrement())
  email      String         @unique
  password   String?
  membership User_Tenants[]
}

model Tenants {
  id          Int            @id @default(autoincrement())
  name        String            @unique
  domain      String         @unique
  status      Tenant_status  @default(PENDING)
  createdAt   DateTime       @default(now())
  updatedAt   DateTime       @updatedAt
  members     User_Tenants[]
  invitations invitations[]

  @@index([status])
}

model Role {
  id   Int       @id @default(autoincrement())
  role Role_type @unique

  membership User_Tenants[]
}

model User_Tenants {
  id       Int     @id @default(autoincrement())
  userId   Int
  tenantId Int
  roleId   Int
  user     Users   @relation(fields: [userId], references: [id], onDelete: Cascade)
  tenant   Tenants @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  role     Role    @relation(fields: [roleId], references: [id], onDelete: Cascade)

  joinedAt DateTime @default(now())

  @@unique([userId, tenantId])
}

model invitations {
  id        Int         @id @default(autoincrement())
  tenantId  Int
  email     String
  token     Status_type @default(PENDING)
  role      String
  expiresAt DateTime
  createdAt DateTime    @default(now())
  tenant    Tenants     @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([email])
  @@index([tenantId])
}

enum Role_type {
  ADMIN
  USER
}

enum Status_type {
  PENDING
  ACCEPT
  EXPIRE
}

enum Tenant_status {
  PENDING
  ACCEPT
  REJECTED
}
